> [!note] 最好不能采取写扩散的模式，因为用户消息量会比较大，采取写扩散模式的话，未签收表的数据量会比较庞大，容易造成数据查询慢的情况。
> 
> 如何设计呢？
> 
> 可以考虑使用：
> 
> 1. **最大签收id+连续id范围的模式**。
>    这种模式需要id是连续的，如何id不是连续的，可以定义消息的群消息排序值，用于替换id的连续id范围。
>    id的连续范围，是用来判断用户消息是否漏签和跳签的。
> 2. **时间窗口+签收id集合的形式**。
>    这个模式是一个比较通用的模式。可以不用考虑用户id是否是连续的。
> 


**最大签收id+连续id范围的模式**


```text
//流程
用户 -> 用户批量，签收消息id集合 -> 后端记录用户最大的签收id，并且记录并合并id的范围

合并id的范围：

签收的是1，2，3  就记录成 1-3。

如果消息是1-5，但是客户端签收的是3，4。

后端记录的是3-4，这就是发生了漏签和跳签。生成用户最大签收id的时候，就需要判断用户是否发生了tiao

用户拉取未签收消息的时候，就


```


**时间窗口+签收id集合的形式**