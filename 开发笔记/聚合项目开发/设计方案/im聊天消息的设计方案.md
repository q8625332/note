> 消息一般设计，要么是读扩散，要么是写扩散，所以到底需要如何设计im的聊天系统呢？
> 现在就将讲解一下，聊天消息的应该如何设计。不同的设计方案，比较适合那种应用场景。

## 写扩散的设计（小型聊天系统）

> 这个方案呢，比较适合小型的聊天室。
> 缺点呢：需要占用的比较大量的签收表，占用的数据库的数量会比较大。

**流程：**

```text

消息 -> 入库 -> 查询群用户，并且排除自己

为每个用户生成一条未签收的消息 -> 批量入库

```

**表：**

**消息表**

| 名字          | 描述    |
| ----------- | ----- |
| id          | id    |
| group_id    | 群id   |
| form_id     | 发送人id |
| content     | 内容    |
| ext         | 扩展数据  |
| create_time | 创建时间  |
| update_time | 更新时间  |
**未签收表**

| 名字          | 描述    |
| ----------- | ----- |
| id          | id    |
| group_id    | 群id   |
| to_id       | 收取人id |
|             |       |
|             |       |
| create_time | 创建时间  |