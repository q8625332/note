## 有不同概率的抽奖

> 比如 10%  20% 30% 保底，这些概率需要怎么抽奖呢？
> 可以使用随机区域法。

**实现**


```java


// Lottery.java
import java.util.List;
import java.util.Map;
import java.util.Random;
import java.util.TreeMap;

public class Lottery {

    // 使用 TreeMap 来存储累积概率和对应的奖品
    // Key: 累积概率, Value: 奖品
    private final TreeMap<Double, Prize> probabilityMap = new TreeMap<>();
    private final Random random = new Random();
    private static final Prize NO_PRIZE = new Prize("谢谢参与", 0);

    /**
     * 构造函数，初始化奖品列表和概率分布
     * @param prizes 奖品列表
     */
    public Lottery(List<Prize> prizes) {
        double cumulativeProbability = 0.0;
        for (Prize prize : prizes) {
            // 检查概率值是否合法
            if (prize.probability() <= 0) {
                continue; // 忽略概率为0或负数的奖品
            }
            cumulativeProbability += prize.probability();
            probabilityMap.put(cumulativeProbability, prize);
        }

        // 确保总概率不超过1.0 (100%)
        if (cumulativeProbability > 1.0) {
            throw new IllegalArgumentException("所有奖品的总概率不能超过 1.0 (100%)");
        }
    }

    /**
     * 执行一次抽奖
     * @return 返回抽中的奖品名称
     */
    public String draw() {
        // 生成一个 0.0 (包含) 到 1.0 (不包含) 之间的随机浮点数
        double randomValue = random.nextDouble();

        // 使用 ceilingEntry 找到第一个累积概率大于或等于随机数的条目
        // 这等同于判断随机数落在了哪个概率区间内
        Map.Entry<Double, Prize> entry = probabilityMap.ceilingEntry(randomValue);

        if (entry != null) {
            // 如果找到了，说明抽中了某个奖品
            return entry.getValue().name();
        } else {
            // 如果没找到（意味着随机数大于所有累积概率的总和），则为“未中奖”
            return NO_PRIZE.name();
        }
    }
}



// Main.java
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class Main {
    public static void main(String[] args) {
        // 1. 定义奖品列表，包含两个概率相同的奖品
        List<Prize> prizes = new ArrayList<>();
        prizes.add(new Prize("一等奖：iPhone 15 Pro", 0.01)); // 1%
        prizes.add(new Prize("二等奖：AirPods Pro", 0.05));   // 5%
        prizes.add(new Prize("三等奖：充电宝", 0.10));         // 10%
        prizes.add(new Prize("三等奖：数据线", 0.10));         // 10% (与上一个概率相同)
        prizes.add(new Prize("鼓励奖：优惠券", 0.20));       // 20%
        // 剩余 1 - (0.01+0.05+0.10+0.10+0.20) = 0.54 (54%) 的概率是“谢谢参与”

        // 2. 创建抽奖器实例
        Lottery lottery = new Lottery(prizes);

        // 3. 模拟单次抽奖
        System.out.println("--- 模拟单次抽奖 ---");
        String result = lottery.draw();
        System.out.println("恭喜你，抽中了: " + result);
        System.out.println();

        // 4. 模拟大量抽奖以验证概率分布
        System.out.println("--- 模拟1,000,000次抽奖以验证概率 ---");
        int totalDraws = 1_000_000;
        Map<String, Integer> stats = new HashMap<>();

        for (int i = 0; i < totalDraws; i++) {
            String prizeName = lottery.draw();
            stats.put(prizeName, stats.getOrDefault(prizeName, 0) + 1);
        }

        // 打印统计结果
        stats.entrySet().stream()
             .sorted(Map.Entry.<String, Integer>comparingByValue().reversed()) // 按次数降序排序
             .forEach(entry -> {
                 double percentage = (double) entry.getValue() / totalDraws * 100;
                 System.out.printf("奖品: %-20s | 抽中次数: %7d | 实际占比: %6.3f%%%n",
                                   entry.getKey(), entry.getValue(), percentage);
             });
    }
}


```
